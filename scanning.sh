#!/bin/bash

declare DEC_TCP
declare DEC_UDP

if [ -z "$1" ]; then
        echo "[*] The scanning needs a target.."
        echo "[*] Usage: $0 <target-IP ADDRESS>"
        exit 0
fi

SCAN_NAME=$1

if [ ! -d /root/NMAP/${SCAN_NAME}.d ]; then
        mkdir /root/NMAP/${SCAN_NAME}.d
fi

echo "Do you want a TOP1000 or a full TCP port scan? [t/f]"
read DEC_TCP

if [[ $DEC_TCP == f ]]; then
        nmap -v -Pn -sC -sV -sS -O --osscan-guess -p0-65535 --reason --open ${SCAN_NAME} -oN /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_TCPscan_full

echo ""
echo "[+++++++++++++++++++++++++++++++++++]"
echo "[+]The following TCP ports are open: "
echo "[+++++++++++++++++++++++++++++++++++]"
echo ""

cat /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_TCPscan_full | grep "^[0-9]*/tcp" | tee /root/NMAP/${SCAN_NAME}.d/UNIQUE__SERVICES_temp

elif [[ $DEC_TCP == t ]]; then
        nmap -v -Pn -sC -sV -sS -O --osscan-guess --reason --open ${SCAN_NAME} -oN /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_TCPscan_1000

echo ""
echo "[+++++++++++++++++++++++++++++++++++]"
echo "[+]The following TCP ports are open: "
echo "[+++++++++++++++++++++++++++++++++++]"
echo ""

cat /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_TCPscan_1000 | grep "^[0-9]*/tcp" | tee /root/NMAP/${SCAN_NAME}.d/UNIQUE__SERVICES_temp
fi


echo ""
echo "Do you want a TOP1000 or a full UDP port scan? [t/f]"
read DEC_UDP

if [[ $DEC_UDP == f ]]; then
        nmap -v -Pn -sC -sV -sU -O --osscan-guess -p0-65535 --reason --open ${SCAN_NAME} -oN /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_UDPscan_full

echo ""
echo "[+++++++++++++++++++++++++++++++++++]"
echo "[+]The following UDP ports are open: "
echo "[+++++++++++++++++++++++++++++++++++]"
echo ""

cat /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_UDPscan_full | grep "^[0-9]*/udp" | tee -a /root/NMAP/${SCAN_NAME}.d/UNIQUE__SERVICES_temp


elif [[ $DEC_UDP == t ]]; then
        nmap -v -Pn -sC -sV -sU -O --osscan-guess --reason --open ${SCAN_NAME} -oN /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_UDPscan_1000

echo ""
echo "[+++++++++++++++++++++++++++++++++++]"
echo "[+]The following UDP ports are open: "
echo "[+++++++++++++++++++++++++++++++++++]"
echo ""

cat /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_UDPscan_1000 | grep "^[0-9]*/udp" | tee -a /root/NMAP/${SCAN_NAME}.d/UNIQUE__SERVICES_temp

fi

echo ""
echo "[++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++]"
echo "In total the following ports were identified for $1:"
echo "[++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++]"
echo ""
cat /root/NMAP/${SCAN_NAME}.d/UNIQUE__SERVICES_temp

if [[ $DEC_UDP != f ]]; then

echo ""
echo "[+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++]"
echo "For the completness we run the full UDP scan in the background"
echo "[+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++]"
echo ""
sleep 3
gnome-terminal -x sh -c "nmap -v -Pn -sC -sV -sU -O --osscan-guess -p0-65535 --reason --open ${SCAN_NAME} -oN /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_UDPscan_full; cat /root/NMAP/${SCAN_NAME}.d/${SCAN_NAME}_UDPscan_full | grep \"^[0-9]*/udp\" | tee -a /root/NMAP/${SCAN_NAME}.d/UNIQUE__SERVICES_temp; bash" 2>/dev/null
fi
